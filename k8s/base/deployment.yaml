apiVersion: apps/v1
kind: Deployment
metadata:
  name: playlist-recommender
  namespace: giovanamachado
  labels:
    app: giovanamachado-playlist-recommender
spec:
  replicas: 3
  selector:
    matchLabels:
      app: giovanamachado-playlist-recommender
  template:
    metadata:
      labels:
        app: giovanamachado-playlist-recommender
      annotations:
        # Force pod restart when ConfigMap changes
        checksum/config: "{{ include (print $.Template.BasePath \"/configmap.yaml\") . | sha256sum }}"
    spec:
      containers:
      - name: frontend
        # Update image tag when code changes to trigger redeployment
        image: docker.io/giovana2ma/playlists-frontend:0.2
        imagePullPolicy: Always
        ports:
        - containerPort: 50013
        env:
        - name: MODEL_FILENAME
          valueFrom:
            configMapKeyRef:
              name: playlist-config
              key: MODEL_FILENAME
        - name: MODEL_PATH
          value: /model/rules_ds2.pkl
        - name: API_PORT
          valueFrom:
            configMapKeyRef:
              name: playlist-config
              key: API_PORT
        - name: API_VERSION
          valueFrom:
            configMapKeyRef:
              name: playlist-config
              key: API_VERSION
        volumeMounts:
        - name: model-volume
          mountPath: /model
      volumes:
      - name: model-volume
        persistentVolumeClaim:
          claimName: project2-pvc
